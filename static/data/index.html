<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="js/mui.min.js"></script>
		<link href="css/mui.min.css" rel="stylesheet" />
		<script type="text/javascript" charset="utf-8">
			mui.init();
		</script>
		<style type="text/css">
			body {
				text-align: center;
			}
			
			button {
				width: 100%;
				margin: 10px auto;
			}
		</style>
	</head>

	<body>

		<button id="getAppPackage" class="mui-btn mui-btn-danger" onclick="getAppPackage();">获取自身APP包名</button>

		<button id="getInstalledAppsInfo" class="mui-btn mui-btn-danger" onclick="getInstalledAppsInfo();">获取已安装APP信息</button>

		<button id="openOtherApp" class="mui-btn mui-btn-danger" onclick="openOtherApp();">打开第三方app</button>

		<button id="gotoAppPermission" class="mui-btn mui-btn-danger" onclick="gotoAppPermission();">打开app权限设置</button>

		<button id="opengallery" class="mui-btn mui-btn-danger" onclick="opengallery();">打开相册</button>
		<button id="openCamera" class="mui-btn mui-btn-danger" onclick="openCamera();">打开相机</button>

		<script>
			//获取自身APP包名
			function getAppPackage() {
				var main = plus.android.runtimeMainActivity();
				var ApplicationInfo = main.getApplicationInfo();
				var packageName = plus.android.getAttribute(ApplicationInfo, "packageName");
				alert(packageName);
				return packageName;
			}

			//获取本机安装的APP的信息
			function getInstalledAppsInfo() {
				var main = plus.android.runtimeMainActivity();
				var packageManager = main.getPackageManager();
				var PackageManager = plus.android.importClass(packageManager);
				var packages = packageManager.getInstalledPackages(PackageManager.GET_UNINSTALLED_PACKAGES);
				var len = plus.android.invoke(packages, 'size');
				var str = '';
				for(var i = 0; i < len; i++) {
					// 安装包信息
					var packageInfo = plus.android.invoke(packages, 'get', i);
					var applicationInfo = plus.android.getAttribute(packageInfo, "applicationInfo");

					// 应用名称
					var appName = plus.android.invoke(applicationInfo, "loadLabel", packageManager);
					// 包名
					var packageName = plus.android.getAttribute(packageInfo, "packageName");
					// 版本号
					var versionCode = plus.android.getAttribute(packageInfo, "versionCode");
					// 图标
					var appIcon = plus.android.invoke(applicationInfo, "loadIcon", packageManager);

					str = str + '{' + '"appName":"' + appName + '","packageName":"' + packageName + '","versionCode":"' + versionCode + '","appIcon":"' + appIcon + '"},';

				}
				str = str.substring(0, str.length - 1);
				alert(str);
				return str;
			}

			//根据APP包名判断是否安装APP
			function isInstalledApp(packageName) {
				packageName = 'com.tencent.mobileqq';
				var main = plus.android.runtimeMainActivity();
				var packageManager = main.getPackageManager();
				var PackageManager = plus.android.importClass(packageManager);
				var packageInfo = packageManager.getPackageInfo(packageName, PackageManager.GET_ACTIVITIES);
				if(packageInfo) {
					alert(1);
					return true;
				} else {
					alert(0);
					return false;
				}
			}

			//自身APP调用第三方APP
			function openOtherApp() {
				var packageName = 'com.tencent.mobileqq';
				var main = plus.android.runtimeMainActivity();
				var packageManager = main.getPackageManager();
				var PackageManager = plus.android.importClass(packageManager);
				var Intent = plus.android.importClass('android.content.Intent');
				var intent = new Intent(packageManager.getLaunchIntentForPackage(packageName)); //可设置表中所有Action字段
				main.startActivity(intent);
			}

			//跳转自身APP权限设置
			function gotoAppPermission(packageName) {
				packageName = getAppPackage();
				var main = plus.android.runtimeMainActivity(); //获取activity
				var Intent = plus.android.importClass('android.content.Intent');
				var Settings = plus.android.importClass('android.provider.Settings');
				var Uri = plus.android.importClass("android.net.Uri");
				var intent = new Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS, Uri.fromParts("package", packageName, null)); //可设置表中所有Action字段
				main.startActivity(intent);
			}

			function opengallery() {
				plus.gallery.pick(function(path) {

					img.src = path; //获得图片路径

				}, function(e) {
					console.log("取消选择图片");
					alert("取消选择图片");
				}, {
					filter: "image"
				});
			}

			function openCamera() {
				var cmr = plus.camera.getCamera();
				cmr.captureImage(function(p) {
					//成功
					plus.io.resolveLocalFileSystemURL(p, function(entry) {

						var img_name = entry.name; //获得图片名称
						var img_path = entry.toLocalURL(); //获得图片路径

					}, function(e) {
						console.log("读取拍照文件错误：" + e.message);
						alert("读取拍照文件错误：" + e.message);
					});

				}, function(e) {
					console.log("失败：" + e.message);
					alert("失败：" + e.message);
				}, {
					//  “_doc/camera/“  为保存文件名
					filename: '_doc/camera/',
					index: 1
				});
			}
		</script>
	</body>

</html>